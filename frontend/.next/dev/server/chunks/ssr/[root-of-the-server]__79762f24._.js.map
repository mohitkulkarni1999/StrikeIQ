{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///D:/StrikeIQ/frontend/components/AuthScreen.tsx"],"sourcesContent":["import React from 'react';\nimport { useAuth } from '../contexts/AuthContext';\nimport { AuthRequiredData } from '../types/dashboard';\n\ninterface AuthScreenProps {\n  authData: AuthRequiredData;\n}\n\nfunction AuthScreen({ authData }: AuthScreenProps) {\n  const { checkAuth } = useAuth();\n\n  const handleReconnect = async () => {\n    // Stop any existing polling\n    const event = new CustomEvent('stopPolling');\n    window.dispatchEvent(event);\n    \n    try {\n      // Get the actual Upstox auth URL from backend\n      // Use absolute URL to ensure it hits the backend on port 8000\n      const baseUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';\n      const authUrl = authData.login_url.startsWith('http') \n        ? authData.login_url \n        : `${baseUrl}${authData.login_url}`;\n      \n      console.log('üîç AuthScreen: Fetching auth URL from:', authUrl);\n      const response = await fetch(authUrl);\n      \n      // Check if response is a redirect (direct URL) or JSON\n      const contentType = response.headers.get('content-type');\n      \n      if (contentType && contentType.includes('application/json')) {\n        // JSON response - parse it\n        const result = await response.json();\n        if (result.status === 'success' && result.data?.authorization_url) {\n          window.location.href = result.data.authorization_url;\n        } else {\n          console.error('Failed to get auth URL:', result);\n          alert('Failed to get authentication URL. Please try again.');\n        }\n      } else {\n        // Direct URL response - redirect to it\n        const url = await response.text();\n        console.log('üîç AuthScreen: Got direct URL, redirecting to:', url);\n        window.location.href = url;\n      }\n    } catch (error) {\n      console.error('Error getting auth URL:', error);\n      alert('Error getting authentication URL. Please try again.');\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center\">\n      <div className=\"max-w-md w-full mx-4\">\n        <div className=\"glass-morphism rounded-2xl p-8 text-center\">\n          {/* Icon */}\n          <div className=\"w-20 h-20 bg-orange-500 rounded-full flex items-center justify-center mx-auto mb-6\">\n            <svg \n              className=\"w-10 h-10 text-white\" \n              fill=\"none\" \n              stroke=\"currentColor\" \n              viewBox=\"0 0 24 24\"\n            >\n              <path \n                strokeLinecap=\"round\" \n                strokeLinejoin=\"round\" \n                strokeWidth={2} \n                d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" \n              />\n            </svg>\n          </div>\n\n          {/* Title */}\n          <h1 className=\"text-3xl font-bold text-white mb-2\">\n            Authentication Required\n          </h1>\n\n          {/* Message */}\n          <p className=\"text-gray-300 mb-8 leading-relaxed\">\n            {authData.message}\n          </p>\n\n          {/* Status Badge */}\n          <div className=\"inline-flex items-center gap-2 bg-orange-500/20 text-orange-400 px-4 py-2 rounded-full mb-8\">\n            <div className=\"w-2 h-2 bg-orange-400 rounded-full animate-pulse\"></div>\n            <span className=\"text-sm font-medium\">Session Expired</span>\n          </div>\n\n          {/* Reconnect Button */}\n          <button\n            onClick={handleReconnect}\n            className=\"w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-orange-500/25\"\n          >\n            <div className=\"flex items-center justify-center gap-3\">\n              <svg \n                className=\"w-5 h-5\" \n                fill=\"none\" \n                stroke=\"currentColor\" \n                viewBox=\"0 0 24 24\"\n              >\n                <path \n                  strokeLinecap=\"round\" \n                  strokeLinejoin=\"round\" \n                  strokeWidth={2} \n                  d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" \n                />\n              </svg>\n              <span>Get Authorization</span>\n            </div>\n          </button>\n\n          {/* Help Text */}\n          <div className=\"mt-6 text-sm text-gray-400\">\n            <p>You'll be redirected to the authorization server.</p>\n            <p className=\"mt-1\">After authorization, you'll be returned here automatically.</p>\n          </div>\n\n          {/* Timestamp */}\n          <div className=\"mt-8 pt-6 border-t border-gray-700\">\n            <p className=\"text-xs text-gray-500\">\n              Detected at: {new Date(authData.timestamp).toLocaleString()}\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default React.memo(AuthScreen);\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAOA,SAAS,WAAW,EAAE,QAAQ,EAAmB;IAC/C,MAAM,EAAE,SAAS,EAAE,GAAG,IAAA,4HAAO;IAE7B,MAAM,kBAAkB;QACtB,4BAA4B;QAC5B,MAAM,QAAQ,IAAI,YAAY;QAC9B,OAAO,aAAa,CAAC;QAErB,IAAI;YACF,8CAA8C;YAC9C,8DAA8D;YAC9D,MAAM,UAAU,6DAAmC;YACnD,MAAM,UAAU,SAAS,SAAS,CAAC,UAAU,CAAC,UAC1C,SAAS,SAAS,GAClB,GAAG,UAAU,SAAS,SAAS,EAAE;YAErC,QAAQ,GAAG,CAAC,0CAA0C;YACtD,MAAM,WAAW,MAAM,MAAM;YAE7B,uDAAuD;YACvD,MAAM,cAAc,SAAS,OAAO,CAAC,GAAG,CAAC;YAEzC,IAAI,eAAe,YAAY,QAAQ,CAAC,qBAAqB;gBAC3D,2BAA2B;gBAC3B,MAAM,SAAS,MAAM,SAAS,IAAI;gBAClC,IAAI,OAAO,MAAM,KAAK,aAAa,OAAO,IAAI,EAAE,mBAAmB;oBACjE,OAAO,QAAQ,CAAC,IAAI,GAAG,OAAO,IAAI,CAAC,iBAAiB;gBACtD,OAAO;oBACL,QAAQ,KAAK,CAAC,2BAA2B;oBACzC,MAAM;gBACR;YACF,OAAO;gBACL,uCAAuC;gBACvC,MAAM,MAAM,MAAM,SAAS,IAAI;gBAC/B,QAAQ,GAAG,CAAC,kDAAkD;gBAC9D,OAAO,QAAQ,CAAC,IAAI,GAAG;YACzB;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,2BAA2B;YACzC,MAAM;QACR;IACF;IAEA,qBACE,qKAAC;QAAI,WAAU;kBACb,cAAA,qKAAC;YAAI,WAAU;sBACb,cAAA,qKAAC;gBAAI,WAAU;;kCAEb,qKAAC;wBAAI,WAAU;kCACb,cAAA,qKAAC;4BACC,WAAU;4BACV,MAAK;4BACL,QAAO;4BACP,SAAQ;sCAER,cAAA,qKAAC;gCACC,eAAc;gCACd,gBAAe;gCACf,aAAa;gCACb,GAAE;;;;;;;;;;;;;;;;kCAMR,qKAAC;wBAAG,WAAU;kCAAqC;;;;;;kCAKnD,qKAAC;wBAAE,WAAU;kCACV,SAAS,OAAO;;;;;;kCAInB,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;gCAAI,WAAU;;;;;;0CACf,qKAAC;gCAAK,WAAU;0CAAsB;;;;;;;;;;;;kCAIxC,qKAAC;wBACC,SAAS;wBACT,WAAU;kCAEV,cAAA,qKAAC;4BAAI,WAAU;;8CACb,qKAAC;oCACC,WAAU;oCACV,MAAK;oCACL,QAAO;oCACP,SAAQ;8CAER,cAAA,qKAAC;wCACC,eAAc;wCACd,gBAAe;wCACf,aAAa;wCACb,GAAE;;;;;;;;;;;8CAGN,qKAAC;8CAAK;;;;;;;;;;;;;;;;;kCAKV,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;0CAAE;;;;;;0CACH,qKAAC;gCAAE,WAAU;0CAAO;;;;;;;;;;;;kCAItB,qKAAC;wBAAI,WAAU;kCACb,cAAA,qKAAC;4BAAE,WAAU;;gCAAwB;gCACrB,IAAI,KAAK,SAAS,SAAS,EAAE,cAAc;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOvE;qDAEe,8GAAK,CAAC,IAAI,CAAC"}},
    {"offset": {"line": 255, "column": 0}, "map": {"version":3,"sources":["file:///D:/StrikeIQ/frontend/pages/auth/index.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useRouter } from 'next/router';\nimport AuthScreen from '../../components/AuthScreen';\nimport { AuthRequiredData } from '../../types/dashboard';\n\nexport default function AuthPage() {\n  const router = useRouter();\n  const [authData, setAuthData] = useState<AuthRequiredData | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [checkingAuth, setCheckingAuth] = useState(true);\n\n  useEffect(() => {\n    // First check if user is already authenticated\n    const checkExistingAuth = async () => {\n      try {\n        const response = await fetch('/api/v1/market/status');\n        const data = await response.json();\n        \n        console.log('üîç AuthPage: Auth check response:', data);\n        \n        // If not auth required, user is already authenticated - redirect to home\n        if (data.status !== 'auth_required') {\n          console.log('üîç AuthPage: User already authenticated, redirecting to home');\n          router.push('/');\n          return;\n        }\n        \n        // User needs authentication, show auth screen\n        console.log('üîç AuthPage: Authentication required, showing auth screen');\n        \n        // Get auth data from URL params or localStorage\n        const urlParams = new URLSearchParams(window.location.search);\n        const error = urlParams.get('error');\n        const message = urlParams.get('message') || 'Authentication required to access market data';\n        \n        // Use backend auth endpoint\n        const defaultAuthData: AuthRequiredData = {\n          session_type: 'AUTH_REQUIRED',\n          mode: 'AUTH',\n          login_url: '/api/v1/auth/upstox',\n          message: error || message,\n          timestamp: new Date().toISOString()\n        };\n\n        setAuthData(defaultAuthData);\n        setLoading(false);\n        setCheckingAuth(false);\n        \n      } catch (error) {\n        console.error('üîç AuthPage: Error checking auth status:', error);\n        // On error, assume auth is needed\n        setCheckingAuth(false);\n        setLoading(false);\n      }\n    };\n\n    checkExistingAuth();\n  }, [router]);\n\n  if (checkingAuth) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center\">\n        <div className=\"text-white text-center\">\n          <div className=\"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p>Checking authentication status...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center\">\n        <div className=\"text-white text-center\">\n          <div className=\"w-16 h-16 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p>Loading authentication...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!authData) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center\">\n        <div className=\"text-white text-center\">\n          <p>Error: Authentication data not available</p>\n        </div>\n      </div>\n    );\n  }\n\n  return <AuthScreen authData={authData} />;\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AAGe,SAAS;IACtB,MAAM,SAAS,IAAA,oIAAS;IACxB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+GAAQ,EAA0B;IAClE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,+GAAQ,EAAC;IACvC,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,+GAAQ,EAAC;IAEjD,IAAA,gHAAS,EAAC;QACR,+CAA+C;QAC/C,MAAM,oBAAoB;YACxB,IAAI;gBACF,MAAM,WAAW,MAAM,MAAM;gBAC7B,MAAM,OAAO,MAAM,SAAS,IAAI;gBAEhC,QAAQ,GAAG,CAAC,qCAAqC;gBAEjD,yEAAyE;gBACzE,IAAI,KAAK,MAAM,KAAK,iBAAiB;oBACnC,QAAQ,GAAG,CAAC;oBACZ,OAAO,IAAI,CAAC;oBACZ;gBACF;gBAEA,8CAA8C;gBAC9C,QAAQ,GAAG,CAAC;gBAEZ,gDAAgD;gBAChD,MAAM,YAAY,IAAI,gBAAgB,OAAO,QAAQ,CAAC,MAAM;gBAC5D,MAAM,QAAQ,UAAU,GAAG,CAAC;gBAC5B,MAAM,UAAU,UAAU,GAAG,CAAC,cAAc;gBAE5C,4BAA4B;gBAC5B,MAAM,kBAAoC;oBACxC,cAAc;oBACd,MAAM;oBACN,WAAW;oBACX,SAAS,SAAS;oBAClB,WAAW,IAAI,OAAO,WAAW;gBACnC;gBAEA,YAAY;gBACZ,WAAW;gBACX,gBAAgB;YAElB,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,4CAA4C;gBAC1D,kCAAkC;gBAClC,gBAAgB;gBAChB,WAAW;YACb;QACF;QAEA;IACF,GAAG;QAAC;KAAO;IAEX,IAAI,cAAc;QAChB,qBACE,qKAAC;YAAI,WAAU;sBACb,cAAA,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAI,WAAU;;;;;;kCACf,qKAAC;kCAAE;;;;;;;;;;;;;;;;;IAIX;IAEA,IAAI,SAAS;QACX,qBACE,qKAAC;YAAI,WAAU;sBACb,cAAA,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAI,WAAU;;;;;;kCACf,qKAAC;kCAAE;;;;;;;;;;;;;;;;;IAIX;IAEA,IAAI,CAAC,UAAU;QACb,qBACE,qKAAC;YAAI,WAAU;sBACb,cAAA,qKAAC;gBAAI,WAAU;0BACb,cAAA,qKAAC;8BAAE;;;;;;;;;;;;;;;;IAIX;IAEA,qBAAO,qKAAC,6HAAU;QAAC,UAAU;;;;;;AAC/B"}}]
}