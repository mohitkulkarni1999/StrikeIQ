{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///D:/StrikeIQ/frontend/types/dashboard.ts"],"sourcesContent":["export interface MarketData {\r\n  symbol: string;\r\n  spot_price: number | null;\r\n  previous_close: number | null;\r\n  change: number | null;\r\n  change_percent: number | null;\r\n  vwap: number | null;\r\n  timestamp: string;\r\n  market_status: 'OPEN' | 'CLOSED' | 'ERROR';\r\n  exchange_timestamp?: string;\r\n}\r\n\r\nexport interface AuthRequiredData {\r\n  session_type: 'AUTH_REQUIRED';\r\n  mode: 'AUTH';\r\n  message: string;\r\n  login_url: string;\r\n  timestamp: string;\r\n}\r\n\r\nexport interface RateLimitData {\r\n  session_type: 'RATE_LIMIT';\r\n  message: string;\r\n  timestamp: string;\r\n}\r\n\r\nexport type DashboardResponse = MarketData | AuthRequiredData | RateLimitData;\r\n\r\nexport function isAuthRequired(data: DashboardResponse): data is AuthRequiredData {\r\n  return 'session_type' in data && data.session_type === 'AUTH_REQUIRED';\r\n}\r\n\r\nexport function isRateLimit(data: DashboardResponse): data is RateLimitData {\r\n  return 'session_type' in data && data.session_type === 'RATE_LIMIT';\r\n}\r\n\r\nexport function isMarketData(data: DashboardResponse): data is MarketData {\r\n  return !isAuthRequired(data) && !isRateLimit(data);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AA4BO,SAAS,eAAe,IAAuB;IACpD,OAAO,kBAAkB,QAAQ,KAAK,YAAY,KAAK;AACzD;AAEO,SAAS,YAAY,IAAuB;IACjD,OAAO,kBAAkB,QAAQ,KAAK,YAAY,KAAK;AACzD;AAEO,SAAS,aAAa,IAAuB;IAClD,OAAO,CAAC,eAAe,SAAS,CAAC,YAAY;AAC/C"}},
    {"offset": {"line": 37, "column": 0}, "map": {"version":3,"sources":["file:///D:/StrikeIQ/frontend/contexts/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useReducer, useEffect, ReactNode } from 'react';\r\nimport { DashboardResponse, isAuthRequired, AuthRequiredData, MarketData } from '../types/dashboard';\r\n\r\ninterface AuthState {\r\n  isAuthenticated: boolean;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n  lastCheck: number;\r\n  mode: 'NORMAL' | 'AUTH';\r\n  loginUrl: string | null;\r\n}\r\n\r\ntype AuthAction = \r\n  | { type: 'AUTH_CHECK_START' }\r\n  | { type: 'AUTH_CHECK_SUCCESS'; isAuthenticated: boolean }\r\n  | { type: 'AUTH_CHECK_ERROR'; error: string }\r\n  | { type: 'AUTH_REQUIRED'; payload: { login_url: string } }\r\n  | { type: 'AUTH_SUCCESS'; isAuthenticated: true };\r\n\r\nconst initialState: AuthState = {\r\n  isAuthenticated: false,\r\n  isLoading: true,\r\n  error: null,\r\n  lastCheck: Date.now(),\r\n  mode: 'NORMAL',\r\n  loginUrl: null,\r\n};\r\n\r\nfunction authReducer(state: AuthState, action: AuthAction): AuthState {\r\n  switch (action.type) {\r\n    case 'AUTH_CHECK_START':\r\n      return { ...state, isLoading: true, error: null };\r\n    \r\n    case 'AUTH_CHECK_SUCCESS':\r\n      return {\r\n        ...state,\r\n        isAuthenticated: action.isAuthenticated,\r\n        isLoading: false,\r\n        error: null,\r\n        lastCheck: Date.now(),\r\n      };\r\n    \r\n    case 'AUTH_CHECK_ERROR':\r\n      return {\r\n        ...state,\r\n        isAuthenticated: false,\r\n        isLoading: false,\r\n        error: action.error,\r\n        lastCheck: Date.now(),\r\n      };\r\n    \r\n    case 'AUTH_REQUIRED':\r\n      return {\r\n        ...state,\r\n        isAuthenticated: false,\r\n        isLoading: false,\r\n        error: 'Authentication required',\r\n        lastCheck: Date.now(),\r\n        mode: 'AUTH',\r\n        loginUrl: action.payload.login_url,\r\n      };\r\n    \r\n    case 'AUTH_SUCCESS':\r\n      return {\r\n        ...state,\r\n        isAuthenticated: true,\r\n        isLoading: false,\r\n        error: null,\r\n        lastCheck: Date.now(),\r\n      };\r\n    \r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\ninterface AuthContextType {\r\n  state: AuthState;\r\n  dispatch: React.Dispatch<AuthAction>;\r\n  checkAuth: () => Promise<void>;\r\n  handleAuthRequired: (authData: AuthRequiredData) => void;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\ninterface AuthProviderProps {\r\n  children: ReactNode;\r\n}\r\n\r\nexport function AuthProvider({ children }: AuthProviderProps) {\r\n  const [state, dispatch] = useReducer(authReducer, initialState);\r\n\r\n  const checkAuth = async () => {\r\n    // Always check auth status, regardless of current state\r\n    dispatch({ type: 'AUTH_CHECK_START' });\r\n    \r\n    try {\r\n      const response = await fetch('/api/dashboard/NIFTY');\r\n      const data: DashboardResponse = await response.json();\r\n      \r\n      if (isAuthRequired(data)) {\r\n        dispatch({ type: 'AUTH_REQUIRED', payload: { login_url: data.login_url } });\r\n      } else {\r\n        dispatch({ type: 'AUTH_CHECK_SUCCESS', isAuthenticated: true });\r\n      }\r\n    } catch (error) {\r\n      dispatch({ type: 'AUTH_CHECK_ERROR', error: error instanceof Error ? error.message : 'Unknown error' });\r\n    }\r\n  };\r\n\r\n  const handleAuthRequired = (authData: AuthRequiredData) => {\r\n    // Prevent redundant setState calls\r\n    if (!state.isAuthenticated && !state.isLoading) {\r\n      return; // Already in auth required state\r\n    }\r\n    \r\n    dispatch({ type: 'AUTH_REQUIRED', payload: { login_url: authData.login_url } });\r\n    // Stop any polling here\r\n    console.log('Authentication required, stopping polling');\r\n  };\r\n\r\n  // Listen for auth status updates from polling\r\n  useEffect(() => {\r\n    console.log('ðŸŽ§ AuthContext: Setting up event listeners');\r\n    \r\n    const handleAuthRequired = (event: CustomEvent) => {\r\n      console.log('ðŸš« AuthContext: Received authRequired event', event.detail);\r\n      const { login_url } = event.detail;\r\n      dispatch({ type: 'AUTH_REQUIRED', payload: { login_url } });\r\n    };\r\n\r\n    const handleAuthSuccess = () => {\r\n      console.log('âœ… AuthContext: Received authSuccess event');\r\n      dispatch({ type: 'AUTH_SUCCESS', isAuthenticated: true });\r\n    };\r\n\r\n    window.addEventListener('authRequired', handleAuthRequired as EventListener);\r\n    window.addEventListener('authSuccess', handleAuthSuccess);\r\n\r\n    console.log('âœ… AuthContext: Event listeners set up');\r\n\r\n    return () => {\r\n      console.log('ðŸ§¹ AuthContext: Cleaning up event listeners');\r\n      window.removeEventListener('authRequired', handleAuthRequired as EventListener);\r\n      window.removeEventListener('authSuccess', handleAuthSuccess);\r\n    };\r\n  }, []);\r\n\r\n  const value: AuthContextType = {\r\n    state,\r\n    dispatch,\r\n    checkAuth,\r\n    handleAuthRequired,\r\n  };\r\n\r\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 203, "column": 0}, "map": {"version":3,"sources":["file:///D:/StrikeIQ/frontend/pages/_app.tsx"],"sourcesContent":["import type { AppProps } from 'next/app';\r\nimport { useEffect } from 'react';\r\nimport { AuthProvider } from '../contexts/AuthContext';\r\nimport '../styles/globals.css';\r\n\r\nfunction MyApp({ Component, pageProps }: AppProps) {\r\n  useEffect(() => {\r\n    // Apply dark mode by default\r\n    document.documentElement.classList.add('dark');\r\n    \r\n    // ï¿½ AUTH EXPIRY LISTENER\r\n    const handleAuthExpired = () => {\r\n      console.warn('ðŸ” Auth expired event received - redirecting to /auth')\r\n      // Clear any stored auth data\r\n      localStorage.removeItem(\"upstox_auth\")\r\n      sessionStorage.removeItem(\"upstox_auth\")\r\n      \r\n      // Redirect to auth screen\r\n      window.location.href = \"/auth\"\r\n    }\r\n\r\n    // Add global event listener for auth expiry\r\n    window.addEventListener(\"auth-expired\", handleAuthExpired)\r\n    \r\n    // ï¿½ðŸ” GLOBAL REST CALL INTERCEPTOR FOR AUDIT\r\n    const originalFetch = window.fetch;\r\n    window.fetch = async (...args) => {\r\n      console.log(\"ðŸŒ REST CALL DETECTED:\", args[0]);\r\n      console.log(\"ðŸŒ REST METHOD:\", args[1]?.method || 'GET');\r\n      console.log(\"ðŸŒ REST TIMESTAMP:\", new Date().toISOString());\r\n      \r\n      const start = performance.now();\r\n      const response = await originalFetch(...args);\r\n      const duration = performance.now() - start;\r\n      \r\n      console.log(\"ðŸŒ REST STATUS:\", response.status);\r\n      console.log(\"ðŸŒ REST DURATION:\", `${duration.toFixed(2)}ms`);\r\n      \r\n      return response;\r\n    };\r\n    \r\n    // ðŸ” AXIOS INTERCEPTOR (if axios is used)\r\n    if (typeof window !== 'undefined' && window.axios) {\r\n      window.axios.interceptors.request.use((config) => {\r\n        console.log(\"ðŸŒ AXIOS REST CALL:\", config.url);\r\n        console.log(\"ðŸŒ AXIOS METHOD:\", config.method);\r\n        return config;\r\n      });\r\n    }\r\n    \r\n    console.log(\"ðŸ” REST/WINDOW INTERCEPTORS INSTALLED\");\r\n    \r\n    // Cleanup on unmount\r\n    return () => {\r\n      window.removeEventListener(\"auth-expired\", handleAuthExpired)\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <AuthProvider>\r\n      <Component {...pageProps} />\r\n    </AuthProvider>\r\n  );\r\n}\r\n\r\nexport default MyApp;\r\n"],"names":[],"mappings":";;;;;AACA;AACA;;;;;AAGA,SAAS,MAAM,EAAE,SAAS,EAAE,SAAS,EAAY;IAC/C,IAAA,gHAAS,EAAC;QACR,6BAA6B;QAC7B,SAAS,eAAe,CAAC,SAAS,CAAC,GAAG,CAAC;QAEvC,yBAAyB;QACzB,MAAM,oBAAoB;YACxB,QAAQ,IAAI,CAAC;YACb,6BAA6B;YAC7B,aAAa,UAAU,CAAC;YACxB,eAAe,UAAU,CAAC;YAE1B,0BAA0B;YAC1B,OAAO,QAAQ,CAAC,IAAI,GAAG;QACzB;QAEA,4CAA4C;QAC5C,OAAO,gBAAgB,CAAC,gBAAgB;QAExC,6CAA6C;QAC7C,MAAM,gBAAgB,OAAO,KAAK;QAClC,OAAO,KAAK,GAAG,OAAO,GAAG;YACvB,QAAQ,GAAG,CAAC,0BAA0B,IAAI,CAAC,EAAE;YAC7C,QAAQ,GAAG,CAAC,mBAAmB,IAAI,CAAC,EAAE,EAAE,UAAU;YAClD,QAAQ,GAAG,CAAC,sBAAsB,IAAI,OAAO,WAAW;YAExD,MAAM,QAAQ,YAAY,GAAG;YAC7B,MAAM,WAAW,MAAM,iBAAiB;YACxC,MAAM,WAAW,YAAY,GAAG,KAAK;YAErC,QAAQ,GAAG,CAAC,mBAAmB,SAAS,MAAM;YAC9C,QAAQ,GAAG,CAAC,qBAAqB,GAAG,SAAS,OAAO,CAAC,GAAG,EAAE,CAAC;YAE3D,OAAO;QACT;QAEA,0CAA0C;QAC1C;;QAQA,QAAQ,GAAG,CAAC;QAEZ,qBAAqB;QACrB,OAAO;YACL,OAAO,mBAAmB,CAAC,gBAAgB;QAC7C;IACF,GAAG,EAAE;IAEL,qBACE,qKAAC,iIAAY;kBACX,cAAA,qKAAC;YAAW,GAAG,SAAS;;;;;;;;;;;AAG9B;uCAEe"}}]
}