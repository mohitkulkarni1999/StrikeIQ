{
  "audit_timestamp": "2026-02-11T17:54:18.220734+00:00",
  "flow_type": "UI-Triggered Upstox OAuth",
  "summary": {
    "total_tests": 18,
    "passed": 14,
    "failed": 4,
    "critical_issues": 1,
    "success_rate": 77.77777777777779
  },
  "flow_diagram": "\n        COMPLETE UI-TRIGGERED AUTHENTICATION FLOW\n        \n        1. USER CLICKS \"CONNECT TO UPSTOX\"\n           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n           \u2502 Frontend: AuthScreen.tsx          \u2502\n           \u2502 - Calls GET /api/v1/auth/upstox \u2502\n           \u2502 - Generates random state             \u2502\n           \u2502 - Stores state in sessionStorage   \u2502\n           \u2502 - Redirects to Upstox with state  \u2502\n           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n           \u2502 Backend: Upstox Auth Service     \u2502\n           \u2502 - Generates secure state              \u2502\n           \u2502 - Stores state with expiration       \u2502\n           \u2502 - Returns auth URL with state       \u2502\n           \u2502 - No hardcoded secrets              \u2502\n           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n        2. USER AUTHENTICATES ON UPSTOX\n           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n           \u2502 Upstox Authorization Page          \u2502\n           \u2502 - User logs in                   \u2502\n           \u2502 - Grants permissions               \u2502\n           \u2502 - Redirects with code & state      \u2502\n           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n        3. UPSTOX REDIRECTS BACK\n           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n           \u2502 Backend: /api/v1/auth/upstox/    \u2502\n           \u2502 callback?code=xxx&state=xxx        \u2502\n           \u2502 - Validates state parameter          \u2502\n           \u2502 - Checks state expiration           \u2502\n           \u2502 - Exchanges code for token         \u2502\n           \u2502 - Stores token securely             \u2502\n           \u2502 - Redirects to frontend            \u2502\n           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n        4. FRONTEND PROCESSES CALLBACK\n           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n           \u2502 Frontend: OAuthHandler.tsx          \u2502\n           \u2502 - Validates returned state           \u2502\n           \u2502 - Triggers auth success callback    \u2502\n           \u2502 - Cleans up sessionStorage         \u2502\n           \u2502 - Redirects to dashboard           \u2502\n           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n        5. AUTHENTICATED STATE\n           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n           \u2502 Frontend: Dashboard.tsx              \u2502\n           \u2502 - Shows market data                \u2502\n           \u2502 - Resumes polling                   \u2502\n           \u2502 - No auth required screen           \u2502\n           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        ",
  "detailed_results": [
    {
      "test": "UI Button Calls Backend Endpoint",
      "status": "\u2705 PASS",
      "details": "Auth URL: True, Client ID: True, Redirect URI: True, State: True",
      "critical": false,
      "timestamp": "2026-02-11T17:54:17.284080+00:00"
    },
    {
      "test": "Authorization URL Security",
      "status": "\u2705 PASS",
      "details": "Response type: True, Client ID: True, State: True, HTTPS: True, Hardcoded secrets: False",
      "critical": false,
      "timestamp": "2026-02-11T17:54:17.284961+00:00"
    },
    {
      "test": "State Parameter Security",
      "status": "\u2705 PASS",
      "details": "Unique states: True, URL-safe: True",
      "critical": false,
      "timestamp": "2026-02-11T17:54:17.285290+00:00"
    },
    {
      "test": "Valid Callback Processing",
      "status": "\u274c FAIL",
      "details": "Exception: 500: Authentication failed",
      "critical": false,
      "timestamp": "2026-02-11T17:54:18.195061+00:00"
    },
    {
      "test": "Missing Authorization Code",
      "status": "\u2705 PASS",
      "details": "Correctly rejected missing code",
      "critical": false,
      "timestamp": "2026-02-11T17:54:18.195952+00:00"
    },
    {
      "test": "Missing State Parameter",
      "status": "\u2705 PASS",
      "details": "Correctly rejected missing state",
      "critical": false,
      "timestamp": "2026-02-11T17:54:18.196517+00:00"
    },
    {
      "test": "Invalid State Parameter",
      "status": "\u2705 PASS",
      "details": "Correctly rejected invalid state",
      "critical": false,
      "timestamp": "2026-02-11T17:54:18.197409+00:00"
    },
    {
      "test": "Expired State Parameter",
      "status": "\u2705 PASS",
      "details": "Correctly rejected expired state",
      "critical": false,
      "timestamp": "2026-02-11T17:54:18.198187+00:00"
    },
    {
      "test": "Token Exchange Security",
      "status": "\ud83d\udea8 CRITICAL FAIL",
      "details": "Exception: Expected '_store_credentials' to have been called once. Called 0 times.",
      "critical": true,
      "timestamp": "2026-02-11T17:54:18.200570+00:00"
    },
    {
      "test": "Token Exchange Failure",
      "status": "\u2705 PASS",
      "details": "Correctly handled token exchange failure",
      "critical": false,
      "timestamp": "2026-02-11T17:54:18.204269+00:00"
    },
    {
      "test": "Post-Login Redirect Success",
      "status": "\u274c FAIL",
      "details": "Exception: name 'create_mock_file_open' is not defined",
      "critical": false,
      "timestamp": "2026-02-11T17:54:18.205858+00:00"
    },
    {
      "test": "State Mismatch Handling",
      "status": "\u274c FAIL",
      "details": "Exception: name 'create_mock_file_open' is not defined",
      "critical": false,
      "timestamp": "2026-02-11T17:54:18.206120+00:00"
    },
    {
      "test": "Expired Authorization Code",
      "status": "\u2705 PASS",
      "details": "Correctly handled expired code",
      "critical": false,
      "timestamp": "2026-02-11T17:54:18.209489+00:00"
    },
    {
      "test": "Network Interruption",
      "status": "\u2705 PASS",
      "details": "Correctly handled network error",
      "critical": false,
      "timestamp": "2026-02-11T17:54:18.210936+00:00"
    },
    {
      "test": "Access Denied",
      "status": "\u2705 PASS",
      "details": "Correctly handled access denied",
      "critical": false,
      "timestamp": "2026-02-11T17:54:18.212425+00:00"
    },
    {
      "test": "HTTPS Enforcement",
      "status": "\u2705 PASS",
      "details": "Authorization URL uses HTTPS: True",
      "critical": false,
      "timestamp": "2026-02-11T17:54:18.213623+00:00"
    },
    {
      "test": "No Sensitive Parameters in URL",
      "status": "\u2705 PASS",
      "details": "Sensitive params in URL: False",
      "critical": false,
      "timestamp": "2026-02-11T17:54:18.214020+00:00"
    },
    {
      "test": "State Parameter Randomness",
      "status": "\u2705 PASS",
      "details": "Generated 10 unique states out of 10 attempts",
      "critical": false,
      "timestamp": "2026-02-11T17:54:18.214313+00:00"
    }
  ],
  "security_status": "CRITICAL"
}